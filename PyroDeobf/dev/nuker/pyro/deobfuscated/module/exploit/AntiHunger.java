//Deobfuscated with https://github.com/PetoPetko/Minecraft-Deobfuscator3000 using mappings "1.12 stable mappings"!

// 
// Decompiled by Procyon v0.5.36
// 

package dev.nuker.pyro.deobfuscated.module.exploit;

import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;
import dev.nuker.pyro.deobfuscated.events.MinecraftEvent;
import dev.nuker.pyro.deobfuscated.events.bus.EventHandler;
import dev.nuker.pyro.deobfuscated.events.network.EventClientPacket;
import dev.nuker.pyro.deobfuscated.events.bus.Listener;
import dev.nuker.pyro.deobfuscated.util.Timer;
import dev.nuker.pyro.deobfuscated.module.Value;
import dev.nuker.pyro.deobfuscated.module.Module;

public final class AntiHunger extends Module
{
    public final Value<Boolean> Sprint;
    public final Value<Boolean> Ground;
    private boolean _isAttemptingElytraFly;
    private Timer _elytraUpdateTimer;
    @EventHandler
    private Listener<EventClientPacket> onClientPacket;
    
    public AntiHunger() {
        super("AntiHunger", new String[] { "NoHunger" }, "Prevents hunger loss by spoofing on ground state", "NONE", 5649762, ModuleType.EXPLOIT);
        this.Sprint = new Value<Boolean>("Sprint", new String[] { "Sprint" }, "Cancel out the sprinting packets", false);
        this.Ground = new Value<Boolean>("Ground", new String[] { "Ground" }, "Spoofs onground state for movement packets", true);
        this._isAttemptingElytraFly = false;
        this._elytraUpdateTimer = new Timer();
        CPacketPlayer packet;
        CPacketEntityAction packet2;
        this.onClientPacket = new Listener<EventClientPacket>(event -> {
            if (event.getStage() == MinecraftEvent.Stage.Pre) {
                if (event.getPacket() instanceof CPacketPlayer && this.Ground.getValue()) {
                    if (this._elytraUpdateTimer.passed(5000.0) && !this.mc.player.isElytraFlying() && this._isAttemptingElytraFly) {
                        this._isAttemptingElytraFly = false;
                    }
                    if (!this.mc.player.isElytraFlying() && !this._isAttemptingElytraFly) {
                        packet = (CPacketPlayer)event.getPacket();
                        if (this.mc.player.fallDistance > 0.0f || this.mc.playerController.isHittingBlock) {
                            packet.onGround = true;
                        }
                        else {
                            packet.onGround = false;
                        }
                    }
                }
                if (event.getPacket() instanceof CPacketEntityAction && this.Sprint.getValue()) {
                    packet2 = (CPacketEntityAction)event.getPacket();
                    if (packet2.getAction() == CPacketEntityAction.Action.START_SPRINTING || packet2.getAction() == CPacketEntityAction.Action.STOP_SPRINTING) {
                        event.cancel();
                    }
                    if (packet2.getAction() == CPacketEntityAction.Action.START_FALL_FLYING) {
                        this._isAttemptingElytraFly = true;
                        this._elytraUpdateTimer.reset();
                    }
                }
            }
        });
    }
}
