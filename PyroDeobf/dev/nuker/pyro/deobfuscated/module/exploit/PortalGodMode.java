//Deobfuscated with https://github.com/PetoPetko/Minecraft-Deobfuscator3000 using mappings "1.12 stable mappings"!

// 
// Decompiled by Procyon v0.5.36
// 

package dev.nuker.pyro.deobfuscated.module.exploit;

import net.minecraft.network.play.client.CPacketConfirmTeleport;
import net.minecraft.network.play.server.SPacketRespawn;
import dev.nuker.pyro.deobfuscated.events.MinecraftEvent;
import dev.nuker.pyro.deobfuscated.events.network.EventClientPacket;
import dev.nuker.pyro.deobfuscated.events.bus.EventHandler;
import dev.nuker.pyro.deobfuscated.events.network.EventServerPacket;
import dev.nuker.pyro.deobfuscated.events.bus.Listener;
import dev.nuker.pyro.deobfuscated.module.Module;

public class PortalGodMode extends Module
{
    private boolean _shouldCancelPacket;
    private int _prevDimensionId;
    @EventHandler
    private Listener<EventServerPacket> onServerPacket;
    @EventHandler
    private Listener<EventClientPacket> onClientPacket;
    
    public PortalGodMode() {
        super("PortalGodMode", new String[] { "PGM" }, "Portal God Mode, cancels the CPacketConfirmTeleport packet", "NONE", 14361665, ModuleType.EXPLOIT);
        this._shouldCancelPacket = false;
        this._prevDimensionId = -420;
        SPacketRespawn packet;
        this.onServerPacket = new Listener<EventServerPacket>(event -> {
            if (event.getStage() != MinecraftEvent.Stage.Pre) {
                return;
            }
            else if (event.getPacket() instanceof SPacketRespawn) {
                packet = (SPacketRespawn)event.getPacket();
                if (packet.getDimensionID() != this._prevDimensionId) {
                    this._prevDimensionId = packet.getDimensionID();
                    this._shouldCancelPacket = true;
                }
                return;
            }
            else {
                return;
            }
        });
        this.onClientPacket = new Listener<EventClientPacket>(event -> {
            if (event.getStage() == MinecraftEvent.Stage.Pre) {
                if (event.getPacket() instanceof CPacketConfirmTeleport && this._shouldCancelPacket) {
                    event.cancel();
                }
            }
        });
    }
    
    @Override
    public void toggleNoSave() {
    }
    
    @Override
    public void onEnable() {
        super.onEnable();
        this._shouldCancelPacket = false;
        this._prevDimensionId = this.mc.player.dimension;
    }
}
